# worflow to call the update.sh script and create a PR based on the changes
name: update
on:
  workflow_run:
    workflows: ["new-release-trigger"]
    types: [completed]
    
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest
    #if: ${{ github.event.workflow_run.conclusion == 'success' }}
    steps:
      - uses: actions/checkout@v3
        
      - uses: cachix/install-nix-action@v22
        with:
          nix_path: nixpkgs=channel:nixos-unstable
          github_access_token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: Update Packages
        run: ./update.sh
          
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          commit-message: Package Version Update
          title: 'Package Version Update'
          body: >
            This PR is auto-generated by 
            [create-pull-request](https://github.com/peter-evans/create-pull-request).
          labels: package update, automated pr
